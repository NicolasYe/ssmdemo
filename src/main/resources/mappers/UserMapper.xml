<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yexu.ssmdemo.mapper.UserMapper">
    <select id="loginAction" resultType="com.yexu.ssmdemo.pojo.User">
        select * from app_user where username=#{username} and password=#{password}
    </select>
    <select id="selectUserByUsername" resultType="com.yexu.ssmdemo.pojo.User">
        select * from app_user where username=#{username}
    </select>
    <select id="selectDeviceByUsername" resultType="com.yexu.ssmdemo.pojo.Device">
        select * from app_device where id in (select id from app_device_user where user_id=(select id from app_user where username=#{username}))
    </select>
    <select id="selectDeviceByDeviceId" resultType="com.yexu.ssmdemo.pojo.Device">
        select * from app_device where device_id like concat ("%",#{deviceId},"%")
    </select>
    <select id="selectUserByDeviceId" resultType="com.yexu.ssmdemo.pojo.User">
        select * from app_user where id in (select user_id from app_device_user where id in(select id from app_device where device_id like concat ("%",#{deviceId},"%")))
    </select>
    <delete id="deleteDeviceByDeviceId">
        delete from app_device where device_id like concat ("%",#{deviceId},"%")
    </delete>
    <delete id="deleteUserByUsername">
        delete from app_user where username=#{username}
    </delete>
    <select id="selectRecordByUsername" resultType="com.yexu.ssmdemo.pojo.Experience">
        select * from app_user_record where user_id=(select id from app_user where username=#{username})
    </select>
    <select id="selectRecordById" resultType="com.yexu.ssmdemo.pojo.Experience">
      select * from app_user_record where id=#{id}
    </select>
    <update id="updateRecord" parameterType="com.yexu.ssmdemo.pojo.Experience">
      update app_user_record
      <set>
          <if test="left_vision!=null">
              left_vision=#{left_version}
          </if>
          <if test="right_vision!=null">
              right_vision=#{right_vision}
          </if>
          <if test="vision!=null">
              vision=#{vision}
          </if>
          <if test="left_degree!=null">
              left_degree=#{left_degree}
          </if>
          <if test="right_degree!=null">
              right_degree=#{right_degree}
          </if>
      </set>
        where id=#{id}

    </update>

    <delete id="deleteRecord">
        delete from app_user_record where id=#{id}
    </delete>
    <delete id="deleteAllRecord">
        delete from app_user_record where user_id=#{userId}
    </delete>
</mapper>